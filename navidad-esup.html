<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Árbol de Navidad Animado</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
    
    <style>
        html, body {
            margin: 0;
            padding: 0;
            width: 100%;
            height: 100%;
            background: #000;
            overflow: hidden;
            font-family: 'Arial', sans-serif;
        }

        #container {
            position: relative;
            width: 100%;
            height: 100%;
        }

        #fixed-bg {
            position: fixed;
            left: 50%;
            top: 50%;
            transform: translate(-50%, -50%);
            width: 100vw;
            height: 100vh;
        }

        canvas {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);  
            aspect-ratio: 1;
        }

        #c {
            width: auto;
            height: 100%;
        }

        #c2 {
            width: 100%;
            height: auto;
        }

        @media (max-aspect-ratio: 1) {
            #c {
                width: 100%;
                height: auto;
            }
            
            #c2 {
                width: auto;
                height: 100%;
            }
        }

        #controls {
            position: absolute;
            bottom: 20px;
            left: 0;
            width: 100%;
            text-align: center;
            z-index: 10;
            color: white;
        }

        button {
            background: rgba(255, 255, 255, 0.2);
            border: 1px solid rgba(255, 255, 255, 0.5);
            color: white;
            padding: 10px 20px;
            margin: 0 10px;
            border-radius: 20px;
            cursor: pointer;
            font-size: 16px;
            transition: all 0.3s ease;
        }

        button:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: scale(1.05);
        }

        #title {
            position: absolute;
            top: 20px;
            left: 0;
            width: 100%;
            text-align: center;
            color: white;
            font-size: 2.5rem;
            text-shadow: 0 0 10px rgba(255, 255, 255, 0.7);
            z-index: 10;
            font-family: 'Georgia', serif;
        }

        #instructions {
            position: absolute;
            top: 80px;
            left: 0;
            width: 100%;
            text-align: center;
            color: rgba(255, 255, 255, 0.7);
            font-size: 1rem;
            z-index: 10;
        }


        #intro {
    position: fixed;
    inset: 0;
    background: black;
    display: flex;
    justify-content: center;
    align-items: center;
    z-index: 50;
}

#fotoGrupo {
    max-width: 70%;
    border-radius: 12px;
    box-shadow: 0 0 40px rgba(255,255,255,.4);
}

/*.escudo {
    position: fixed;
    top: 12px;
    width: 110px;
    z-index: 9999; /* Siempre por encima de todo 
    pointer-events: none;

    /* Brillo institucional permanente 
    filter: drop-shadow(0 0 14px rgba(255, 215, 120, 0.9));
    animation: glowInstitutional 3s ease-in-out infinite;
}*/

@keyframes glowInstitutional {
    0%, 100% {
        filter: drop-shadow(0 0 10px rgba(255,215,120,0.8));
    }
    50% {
        filter: drop-shadow(0 0 24px rgba(255,215,120,1));
    }
}

/* EXTREMOS SUPERIORES */
/*.escudo.left {
    left: 12px;
}

.escudo.right {
    right: 12px;
}*/



#mensaje {
    position: fixed;
    inset: 0;
    pointer-events: none;
    z-index: 20;
}

.mensaje {
    position: absolute;
    top: 50%;
    max-width: 28%;
    font-size: 1.25rem;
    line-height: 1.6;
    color: white;
    text-shadow: 0 0 12px rgba(255,255,255,0.35);
    transform: translateY(-50%);
}

/* LADO IZQUIERDO */
.mensaje.izquierda {
    left: 5%;
    text-align: right;
}

/* LADO DERECHO */
.mensaje.derecha {
    right: 5%;
    text-align: left;
}

/*@media (max-width: 768px) {

    /* ESCUDOS: NO TAPAN TEXTO */
    /*.escudo {
        width: 68px;
        top: 6px;
        z-index: 5; 
        opacity: 0.9;
    }*/

    /* TITULO FELIZ NAVIDAD 
    #title {
        font-size: 1.6rem;
        top: 90px;
        padding: 0 12px;
        line-height: 1.2;
        z-index: 15;
    }

    /* MENSAJES 
    #mensaje {
        position: absolute;
        bottom: 20px;
        top: auto;
        display: flex;
        flex-direction: column;
        gap: 14px;
        z-index: 20;
    }

    .mensaje {
        position: static;
        max-width: 92%;
        text-align: center !important;
        margin: 0 auto;
        transform: none !important; 
        font-size: 1rem;
        line-height: 1.5;
    }
}*/

@media (max-width: 768px) {
    #title {
        font-size: 1.6rem;
        top: 90px;
        padding: 0 12px;
        line-height: 1.2;
        z-index: 15;
    }
    #mensaje {
        position: fixed;
        inset: 0;
        z-index: 20;
        pointer-events: none;
    }

    .mensaje {
        top: 55%;
        max-width: 38%;
        font-size: 0.9rem;
        line-height: 1.4;
        transform: translateY(-50%);
    }

    .mensaje.izquierda {
        left: 2%;
        text-align: right;
    }

    .mensaje.derecha {
        right: 2%;
        text-align: left;
    }
}


        

/* CONTENEDOR GLOBAL */
#escudos-global {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 90px;
    z-index: 300;
    pointer-events: none;
}

/* ESCUDOS */
.escudo {
    position: absolute;
    top: 8px;
    width: 110px;
    opacity: 1;
    filter: drop-shadow(0 0 14px rgba(255,215,120,0.9));
    animation: glowInstitutional 3s ease-in-out infinite;
}

.escudo.left {
    left: 8px;
}

.escudo.right {
    right: 8px;
}

/* MÓVIL */
@media (max-width: 768px) {
    #escudos-global {
        height: 70px;
    }

    .escudo {
        width: 68px;
        top: 6px;
    }
}


    </style>
</head>
<body>
    <!-- ESCENA INICIAL -->
     
    <audio id="musica" src="navidad.mp3" muted loop playsinline></audio>
<div id="intro">
   
    <img src="foto.jpeg" id="fotoGrupo" alt="Dotación ESGN">
    
    
</div>

<div id="escudos-global">
    <img src="escudo-esup.png" class="escudo left">
    <img src="escudo-mgp.png" class="escudo right">
</div>

<!-- MENSAJE FINAL -->
<div id="mensaje">
    <div class="mensaje izquierda">
        SSOO, les deseo una Feliz Navidad, con paz y unión familiar.
    </div>

    <div class="mensaje derecha">
        Que el Año 2026 traiga salud, prosperidad y éxitos profesionales y personales.
        <br><br>
    </div>
</div>


    <div id="container">
        <div id="title">¡Feliz Navidad y próspero Año Nuevo!</div>
        
        <div id="fixed-bg">
            <canvas id="c2"></canvas>
            <canvas id="c"></canvas>
        </div>
        
        <div id="controls">
            <button id="colorBtn">Cambiar Colores</button>
            <button id="speedBtn">Velocidad: Rápida</button>
        </div>
    </div>


    
<script>

    

    const arr = []
    const c = document.querySelector('#c')
    const ctx = c.getContext('2d')
    const cw = (c.width = 2000)
    const ch = (c.height = 2000)
    const T = Math.PI * 2
    const m = { x: cw / 2, y: 0 }
    const xTo = gsap.quickTo(m, 'x', { duration: 1.5, ease: 'expo' })
    const yTo = gsap.quickTo(m, 'y', { duration: 1.5, ease: 'expo' })

    const arr2 = []
    const c2 = document.querySelector('#c2')
    const ctx2 = c2.getContext('2d')
    c2.width = c2.height = 2000

    const colorSchemes = [
        ['#ffffff', '#ff0000', '#00ff00', '#ffff00', '#00ffff'],
        ['#00ff00', '#00ff80', '#00ffff', '#0080ff', '#8000ff'],
        ['#ff00ff', '#ff0080', '#ff0000', '#ff8000', '#ffff00'],
    ]

    let currentColorScheme = 0
    let animationSpeed = 2

    c.addEventListener('pointermove', e => {
        const rect = c.getBoundingClientRect()
        const mouseX = e.x - rect.left
        const mouseY = e.y - rect.top
        const scaleX = c.width / rect.width
        const scaleY = c.height / rect.height
        xTo(mouseX * scaleX)
        yTo(mouseY * scaleY)
    })

    document.getElementById('colorBtn').addEventListener('click', changeColors)
    document.getElementById('speedBtn').addEventListener('click', toggleSpeed)


    function resizeCanvas() {
        const size = Math.min(window.innerWidth, window.innerHeight);
        c.width = c.height = size * 1.2;
        c2.width = c2.height = size * 1.2;

        m.x = c.width / 2;
        m.y = 0;
    }



    function createTreeParticles() {
        arr.length = 0
        const numElements = 1000
        for (let i = 0; i < numElements; i++) {
            arr.push({
                i: i,
                cx: cw / 2,
                cy: gsap.utils.mapRange(0, numElements - 1, 300, 1850, i),
                r: i < 900 ? gsap.utils.mapRange(0, numElements - 1, 1.5, 385, i) : 25,
                dot: 4.5,
                prog: 0.25,
                s: 1,
                color: colorSchemes[currentColorScheme][Math.floor(Math.random() * colorSchemes[currentColorScheme].length)]
            })

            const d = 99
            arr[i].t = gsap.timeline({ repeat: -1 })
                .to(arr[i], { duration: d, prog: '+=1', ease: 'slow(0.3, 0.4)' })
                .to(arr[i], {
                    duration: d / 2, s: 0.15, repeat: 1, yoyo: true, ease: 'power3.inOut'
                }, 0)
                .seek(Math.random() * d)
        }
    }

    function createSnowflakes() {
        arr2.length = 0
        const numSnow = 300
        for (let i = 0; i < numSnow; i++) {
            arr2.push({
                x: cw * Math.random(),
                y: -4.5,
                s: 1.5 + 2.5 * Math.random(),
                a: 0.1 + 0.5 * Math.random(),
                swing: Math.random() * 100
            })

            arr2[i].t = gsap.timeline({ repeat: -1 })
                .to(arr2[i], {
                    duration: arr2[i].s * 13.33,
                    x: `+=${66.67 * Math.random()}`,
                    ease: 'sine.inOut'
                })
                .to(arr2[i], {
                    duration: arr2[i].s * 13.33,
                    x: `-=${66.67 * Math.random()}`,
                    ease: 'sine.inOut'
                }, 0)
                .to(arr2[i], {
                    duration: arr2[i].s * 66.67,
                    y: ch,
                    ease: 'none'
                }, 0)
                .seek(Math.random() * 99)
                .timeScale(animationSpeed)
        }
    }

const star = {
    x: cw / 2,
    y: 250,
    size: 50,
    brightness: 0.7,
    visible: false
}

setTimeout(() => {
    star.visible = true
}, 1000)


// Dibujar estrella
function drawStar() {
    if (!star.visible) return;

    ctx.save()

    ctx.shadowColor = "rgb(255, 210, 80)"
    ctx.shadowBlur = 18

    const spikes = 5
    const outer = star.size
    const inner = star.size * 0.45

    ctx.beginPath()
    ctx.moveTo(star.x, star.y - outer)

    for (let i = 0; i < spikes; i++) {
        let angleOuter = (Math.PI * 2 * i) / spikes - Math.PI / 2
        let angleInner = angleOuter + Math.PI / spikes

        ctx.lineTo(star.x + Math.cos(angleOuter) * outer, star.y + Math.sin(angleOuter) * outer)
        ctx.lineTo(star.x + Math.cos(angleInner) * inner, star.y + Math.sin(angleInner) * inner)
    }

    ctx.closePath()
    ctx.fillStyle = `rgba(255, 220, 90, ${0.95 * star.brightness})` // ⭐ amarillo más suave
    ctx.fill()

    ctx.strokeStyle = `rgba(255, 230, 120, ${0.7 * star.brightness})`
    ctx.lineWidth = 2

    const rayLength = inner

    for (let i = 0; i < 8; i++) {
        let ang = (Math.PI * 2 * i) / 8

        ctx.beginPath()
        ctx.moveTo(star.x, star.y)
        ctx.lineTo(star.x + Math.cos(ang) * rayLength, star.y + Math.sin(ang) * rayLength)
        ctx.stroke()
    }

    ctx.restore()
}


    function render() {
        ctx.clearRect(0, 0, cw, ch)
        ctx2.clearRect(0, 0, cw, ch)

        drawStar()
        arr.forEach(c => drawDot(c))
        arr2.forEach(c => drawSnow(c))
    }

    function drawDot(c) {
        const angle = c.prog * T
        const vs = 0.2
        const x = Math.cos(angle) * c.r + c.cx
        const y = Math.sin(angle) * c.r * vs + c.cy
        const d = Math.sqrt((x - m.x) ** 2 + (y - m.y) ** 2)
        const ms = gsap.utils.clamp(0.07, 1, d / cw)

        ctx.save()
        ctx.fillStyle = c.color
        ctx.strokeStyle = `rgba(255,255,255,${0.05 * c.s})`

        ctx.beginPath()
        ctx.arc(x, y, (c.dot * c.s) / 2 / ms, 0, T)
        ctx.fill()
        ctx.lineWidth = (c.dot * c.s * 2) / ms
        ctx.stroke()
        ctx.restore()
    }

    function drawSnow(c) {
        const ys = gsap.utils.interpolate(1.3, 0.1, c.y / ch)
        ctx2.beginPath()
        ctx2.arc(c.x, c.y, c.s * ys, 0, T)
        ctx2.globalAlpha = c.a * ys
        ctx2.fillStyle = '#ffffff'
        ctx2.fill()
    }

    createTreeParticles()
    createSnowflakes()
    gsap.ticker.add(render)

    function changeColors() {
        currentColorScheme = (currentColorScheme + 1) % colorSchemes.length
        arr.forEach(particle => {
            particle.color = colorSchemes[currentColorScheme][Math.floor(Math.random() * colorSchemes[currentColorScheme].length)]
        })
    }

    function toggleSpeed() {
        animationSpeed = animationSpeed === 2 ? 1 : 2
        document.getElementById('speedBtn').textContent = `Velocidad: ${animationSpeed === 2 ? 'Rápida' : 'Normal'}`
        
        arr.forEach(p => p.t.timeScale(animationSpeed))
        arr2.forEach(n => n.t.timeScale(animationSpeed))
    }

    gsap.from(arr, {
        duration: 2,
        dot: 0,
        ease: 'back.out(9)',
        stagger: -0.0009
    })

    gsap.from(m, {
        duration: 1.5,
        y: ch * 1.2,
        ease: 'power2.inOut'
    })

    gsap.to(arr, {
        duration: 1,
        s: 0.5,
        repeat: -1,
        yoyo: true,
        stagger: {
            amount: 2,
            from: 'random'
        },
        ease: 'sine.inOut'
    })




gsap.timeline()
    // Espera 4 segundos
    .to({}, { duration: 4 })

    // Absorción mágica de la foto
    .to("#fotoGrupo", {
        duration: 1.8,
        scale: 0,
        rotation: 720,
        filter: "blur(20px)",
        ease: "expo.in"
    })

    // Desaparece escena inicial
    .to("#intro", {
        duration: 1,
        opacity: 0,
        onComplete: () => {
            document.getElementById("intro").style.display = "none";
        }
    })

    // Aparece árbol (canvas)
    .from("#fixed-bg", {
        duration: 2,
        scale: 0.8,
        opacity: 0,
        ease: "power2.out"
    })

    // Mensaje institucional
    .to("#mensaje", {
        duration: 2,
        opacity: 1,
        ease: "power2.out"
    });


if (window.innerWidth > 768) {
    gsap.from(".mensaje.izquierda", {
        duration: 2,
        x: -120,
        opacity: 0,
        ease: "power3.out"
    });

    gsap.from(".mensaje.derecha", {
        duration: 2,
        x: 120,
        opacity: 0,
        ease: "power3.out",
        delay: 0.3
    });
} else {
    gsap.from(".mensaje", {
        duration: 1.5,
        opacity: 0,
        y: 20,
        ease: "power2.out"
    });
}



c.addEventListener("touchmove", e => {
    const t = e.touches[0];
    const rect = c.getBoundingClientRect();
    xTo((t.clientX - rect.left) * (c.width / rect.width));
    yTo((t.clientY - rect.top) * (c.height / rect.height));
});


// ==== AUDIO AUTOPLAY SIN BOTÓN (SEGURO) ====
//window.addEventListener("DOMContentLoaded", () => {
//    const musica = document.getElementById("musica");
//    if (!musica) return;

//    musica.volume = 0.6;

  //  function activarAudio() {
 //       musica.muted = false;
 //       musica.play().catch(() => {});

  //      window.removeEventListener("pointerdown", activarAudio);
  //      window.removeEventListener("mousemove", activarAudio);
   //     window.removeEventListener("touchstart", activarAudio);
//    }

    // Primer gesto natural del usuario
//    window.addEventListener("pointerdown", activarAudio, { once: true });
//    window.addEventListener("mousemove", activarAudio, { once: true });
//    window.addEventListener("touchstart", activarAudio, { once: true });
});
/*
const musica = document.getElementById("musica");
musica.volume = 0.6;

// Activación real permitida por navegadores
function activarAudio() {
    musica.muted = false;
    musica.play().catch(() => {});
    window.removeEventListener("pointerdown", activarAudio);
    window.removeEventListener("touchstart", activarAudio);
}

// Primer gesto válido (PC + móvil)
window.addEventListener("pointerdown", activarAudio, { once: true });
window.addEventListener("touchstart", activarAudio, { once: true });

*/

    window.addEventListener("DOMContentLoaded", () => {
    const musica = document.getElementById("musica");
    if (!musica) return;

    musica.volume = 0.6;

    const activarAudio = () => {
        musica.muted = false;
        musica.play().catch(() => {});
        window.removeEventListener("touchstart", activarAudio);
        window.removeEventListener("pointerdown", activarAudio);
    };

    window.addEventListener("touchstart", activarAudio, { once: true });
    window.addEventListener("pointerdown", activarAudio, { once: true });
});


</script>

</body>
</html>
